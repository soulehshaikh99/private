let e="";const t=document.querySelector("#s"),c=document.querySelector("#o"),n=document.querySelector("#y"),s=document.querySelector("#f"),a=document.querySelector("#b");async function u(){if(e)return{success:!0,publicKey:e};try{const t=await fetch("/api/getPublicKey.php",{method:"GET"}),c=await t.json();return e=c.publicKey,{success:!0,publicKey:e}}catch(e){return{success:!1,publicKey:null}}}async function r(e){try{const t=await u();if(!t.success)return null;const c=window.forge.pki.publicKeyFromPem(t.publicKey),n=JSON.stringify(e),s=c.encrypt(n,"RSA-OAEP");return{success:!0,data:window.forge.util.encode64(s)}}catch(e){return{success:!1,data:null}}}t.addEventListener("submit",(async function(e){e.preventDefault(),a.disabled=!0,a.textContent="Sending...";try{const e=c.value,a=n.value,u=s.value,o=await r({email:e,subject:a,message:u});if(!o.success)throw new Error("");const i=await fetch(t.action,{method:"POST",body:JSON.stringify({data:o.data}),headers:{"Content-Type":"application/json"}}),l=await i.json();alert(l.message),"success"===l.status&&t.reset()}catch(e){alert("Something went wrong. Please try again.")}finally{a.disabled=!1,a.textContent="Send message"}}));